# Техническое задание (ТЗ)
## Система аренды оборудования «Амерта»

**Версия:** 1.0  
**Статус:** Draft  
**Автор:** Мазур В.В.  
**Дата:** 22.11.2024

---

## 1. Общая информация

### 1.1. Назначение документа
Настоящее техническое задание описывает функциональные и нефункциональные требования к системе аренды оборудования «Амерта» (далее — **Система**), включая пользовательские сценарии, критерии приёмки и правила обработки ошибок.

Документ предназначен для:
- разработки (frontend/backend)
- тестирования (QA)
- согласования требований с руководителем/стейкхолдерами

---

### 1.2. Область действия
Система предоставляет:
- регистрацию и авторизацию пользователей
- просмотр каталога оборудования
- управление корзиной и расчёт стоимости аренды
- применение промокодов
- экспорт сметы
- администрирование: импорт каталога, управление пользователями и промокодами

---

### 1.3. Роли и права доступа

| Роль | Описание | Доступ |
|---|---|---|
| Гость | Неавторизованный пользователь | Экран входа/регистрации |
| Пользователь | Авторизованный пользователь | Каталог, корзина, расчёт, экспорт, профиль |
| Администратор | Пользователь с расширенными правами | Всё как у пользователя + админ-панель |

---

### 1.4. Термины и определения

| Термин | Определение |
|---|---|
| Каталог | Список оборудования, доступного для аренды, сгруппированный по категориям |
| Позиция | Конкретная единица оборудования в каталоге |
| Корзина | Раздел для формирования списка арендуемых позиций и расчёта |
| Период аренды | Дата и время начала и окончания аренды |
| Смета | Результат расчёта стоимости аренды (с промокодом и без при наличии промокода) |
| Промокод | Код скидки, применяемый при расчёте стоимости аренды |

---

## 2. Общие требования к пользовательскому интерфейсу (UI)

### 2.1. Шапка главной страницы
На главной странице должны присутствовать:
1. Переход в личный кабинет
2. Переход на главную (логотип + название компании)
3. Переход в корзину (со счётчиком позиций)

### 2.2. Главная страница — содержимое
- Поисковая строка
- Категории с группами позиций
- Каждая позиция содержит:
  - Название позиции
  - Суточный тариф
  - Недельный тариф
  - Тариф **Чт 17:00 → Пн 12:00**
  - Тариф **Пт 17:00 → Пн 12:00**
  - Тумблер/контрол для добавления/удаления позиции из корзины

---

## 3. Функциональные требования

### 3.1. Аутентификация и управление сессией

#### ~~FR-01 Регистрация пользователя~~
~~**Описание:** Пользователь регистрируется по email и паролю.~~

~~**Требования:**~~
- ~~Логин является email~~
- ~~Пароль: минимум 8 символов~~
- ~~Подтверждение пароля обязательно~~
- ~~После успешной регистрации пользователь автоматически авторизуется и попадает на главную/в профиль~~

~~**Связанные User Stories:** US-01~~

---

#### FR-02 Авторизация пользователя
**Описание:** Пользователь входит в систему по email и паролю.

**Требования:**
- Вход осуществляется по email + пароль
- При неверных данных отображается сообщение: **«Неверный логин или пароль»**
- После успешного входа создаётся сессия пользователя

**Связанные User Stories:** US-02

---

#### FR-03 Выход из системы
**Описание:** Пользователь завершает сессию.

**Требования:**
- После выхода пользователь перенаправляется на экран аутентификации
- Доступ к защищённым разделам после выхода невозможен

**Связанные User Stories:** US-04

---

### 3.2. Личный кабинет

#### FR-04 Просмотр профиля
**Описание:** Пользователь открывает личный кабинет.

**Требования:**
- Отображаются: имя, email
- Доступна кнопка «Выход»
- Для администратора отображается доступ к админ-панели

**Связанные User Stories:** US-03

---

### 3.3. Каталог

#### FR-05 Просмотр каталога
**Описание:** Пользователь просматривает каталог, сгруппированный по категориям.

**Требования:**
- Каталог отображается на главной странице
- Категории/группы раскрываются
- Для каждой позиции отображаются тарифы (см. раздел 2.2)

**Связанные User Stories:** US-05

---

#### FR-06 Поиск по каталогу
**Описание:** Пользователь выполняет поиск по каталогу.

**Требования:**
- Поиск работает по названиям групп и позиций
- При отсутствии совпадений — пустое состояние

**Связанные User Stories:** US-06

---

### 3.4. Корзина и расчёт

#### FR-07 Добавление/удаление позиций в корзину
**Описание:** Пользователь добавляет позиции в корзину из каталога.

**Требования:**
- Добавление позиции увеличивает счётчик корзины
- Повторное действие удаляет позицию и уменьшает счётчик

**Связанные User Stories:** US-07

---

#### FR-08 Изменение количества позиций
**Описание:** Пользователь изменяет количество единиц товара в корзине.

**Требования:**
- Кнопка `+` увеличивает количество на 1
- Кнопка `-` уменьшает количество на 1
- При уменьшении количества с 1 до 0 — позиция удаляется из корзины

**Связанные User Stories:** US-08

---

#### FR-09 Выбор периода аренды (календарь)
**Описание:** Пользователь выбирает период аренды.

**Требования:**
- Пользователь выбирает дату начала и дату окончания
- Пользователь указывает время начала и окончания
- При повторном открытии календаря отображается ранее выбранный период и допускается его изменение
- Выбранный период отображается в корзине

**Связанные User Stories:** US-09

---

#### FR-10 Расчёт стоимости аренды
**Описание:** Пользователь рассчитывает стоимость аренды.

**Требования:**
- Кнопка «Рассчитать» доступна только если:
  - в корзине есть хотя бы одна позиция
  - выбран период аренды
- Результат расчёта отображает итоговую стоимость аренды

**Связанные User Stories:** US-10

---

### 3.5. Промокоды (в корзине)

#### FR-11 Применение промокода
**Описание:** Пользователь применяет промокод к расчёту.

**Требования:**
- При валидном промокоде скидка применяется при расчёте
- Отображается стоимость **с промокодом** и **без промокода**
- При невалидном промокоде отображается ошибка, а расчёт выполняется без скидки

**Связанные User Stories:** US-11

---

### 3.6. Экспорт сметы

#### FR-12 Экспорт результата расчёта
**Описание:** Пользователь экспортирует рассчитанную смету в файл.

**Требования:**
- Кнопка «Экспорт» доступна только после выполнения расчёта
- При нажатии формируется файл со сметой и становится доступен пользователю

**Связанные User Stories:** US-12

---

### 3.7. Администрирование

#### FR-13 Импорт каталога (админ)
**Описание:** Администратор импортирует файл каталога.

**Требования:**
- Доступно действие загрузки файла
- При успешной обработке каталог обновляется для всех пользователей
- При некорректном формате файла — импорт не выполняется и отображается ошибка

**Связанные User Stories:** US-13

---

#### FR-14 Управление пользователями (админ)
**Описание:** Администратор создаёт и удаляет пользователей.

**Требования:**
- Создание:
  - email уникален
  - пароль минимум 8 символов
- Удаление:
  - пользователь удаляется и теряет доступ

**Связанные User Stories:** US-14

---

#### FR-15 Управление промокодами (админ)
**Описание:** Администратор создаёт и удаляет промокоды.

**Требования:**
- Промокод уникален
- Скидка: значение > 0 и < 100 (%)

**Связанные User Stories:** US-15

---

## 4. Обработка ошибок и альтернативные сценарии

### 4.1. Глобальные альтернативные сценарии (ERR)

#### ERR-01 — Ошибка сервера / недоступность сервиса
**Условие:** операция не может быть выполнена (ошибка сервера/таймаут/сеть).  
**Поведение:**
1. Операция не выполняется
2. Состояние системы не меняется
3. Отображается сообщение: **«Внутренняя ошибка сервиса. Пожалуйста, попробуйте позже»**
4. Пользователь остаётся в текущем контексте

---

#### ERR-02 — Ошибка валидации данных
**Условие:** данные не соответствуют правилам (email/пароль/значения и т.п.).  
**Поведение:**
1. Операция не выполняется
2. Поля с ошибками подсвечиваются
3. Отображается сообщение о причине
4. Действие недоступно до исправления

---

#### ERR-03 — Дубликат сущности
**Условие:** email уже зарегистрирован / промокод уже существует.  
**Поведение:**
1. Сущность не создаётся
2. Отображается сообщение об ошибке (например: «Пользователь уже зарегистрирован» / «Промокод уже существует»)
3. Пользователь остаётся на форме

---

#### ERR-04 — Сущность не найдена
**Условие:** сущность отсутствует (пользователь/промокод/результаты поиска).  
**Поведение:**
- Авторизация: сообщение **«Неверный логин или пароль»**
- Промокод: отображается ошибка, расчёт без скидки
- Поиск: отображается пустое состояние

---

#### ERR-05 — Некорректный формат импортируемого файла
**Условие:** файл не соответствует ожидаемому формату/структуре.  
**Поведение:**
1. Импорт не выполняется
2. Каталог не изменяется
3. Отображается сообщение: **«Некорректный формат файла»**

---

### 4.2. Локальные альтернативные сценарии (LOC)

#### LOC-01 — Закрытие модального окна кликом вне формы
**Условие:** пользователь нажимает вне области модального окна.  
**Поведение:** модальное окно закрывается, пользователь остаётся на предыдущей странице.

#### LOC-02 — Повторное открытие календаря
**Условие:** пользователь повторно открывает календарь.  
**Поведение:** ранее выбранный диапазон отображается и может быть изменён.

#### LOC-03 — Удаление позиции повторным действием
**Условие:** пользователь повторно нажимает тумблер добавления товара.  
**Поведение:** товар удаляется из корзины.

#### LOC-04 — Удаление товара при уменьшении количества
**Условие:** количество товара равно 1 и пользователь нажимает `-`.  
**Поведение:** товар удаляется из корзины.

---

## 5. Критерии приёмки (User Stories)

### ~~US-01 — Регистрация пользователя~~
~~Как **новый пользователь** я хочу **зарегистрироваться, используя email и пароль**, чтобы **получить доступ к системе**.~~

- ~~**Дано:** пользователь на экране аутентификации~~  
  ~~**Когда:** открывает регистрацию~~  
  ~~**Тогда:** видит поля email/пароль/подтверждение, кнопка «Создать аккаунт» неактивна по умолчанию.~~
- ~~**Дано:** данные валидны (email; пароль ≥ 8; пароли совпадают)~~  
  ~~**Когда:** нажимает «Создать аккаунт»~~  
  ~~**Тогда:** аккаунт создаётся, пользователь авторизуется, отображается уведомление.~~
- ~~**Дано:** email уже существует~~  
  ~~**Когда:** пытается зарегистрироваться~~  
  ~~**Тогда:** применяется **ERR-03**.~~
- ~~**Дано:** данные невалидны~~  
  ~~**Тогда:** применяется **ERR-02**.~~
- ~~**Дано:** сервис недоступен~~  
  ~~**Тогда:** применяется **ERR-01**.~~

### US-02 — Авторизация пользователя
Как **зарегистрированный пользователь** я хочу **войти**, чтобы **получить доступ к функционалу**.

- Успешный вход → авторизация, переход на главную/профиль
- Неверные данные / пользователь не найден → **ERR-04**
- Ошибка сервиса → **ERR-01**

### US-03 — Личный кабинет
Как **авторизованный пользователь** я хочу **открыть профиль**, чтобы **увидеть свои данные**.

- Открытие формы профиля (имя, email, выход)
- Закрытие кликом вне формы → **LOC-01**
- Для администратора доступна админ-панель

### US-04 — Выход
Как **авторизованный пользователь** я хочу **выйти**, чтобы **завершить сессию**.

- Выход завершает сессию и переводит на экран аутентификации

### US-05 — Просмотр каталога
Как **пользователь** я хочу **просматривать каталог**, чтобы **выбрать оборудование**.

- Каталог сгруппирован по категориям
- Категории раскрываются, видны позиции и тарифы

### US-06 — Поиск по каталогу
Как **пользователь** я хочу **искать**, чтобы **быстро находить позиции**.

- Поиск фильтрует группы/позиции
- Нет результатов → пустое состояние (**ERR-04** для поиска)

### US-07 — Добавление/удаление из корзины
Как **пользователь** я хочу **управлять корзиной**, чтобы **сформировать список**.

- Добавление увеличивает счётчик
- Повторное действие удаляет позицию → **LOC-03**

### US-08 — Изменение количества
Как **пользователь** я хочу **менять количество**, чтобы **арендовать нужное число единиц**.

- `+` увеличивает
- `-` уменьшает
- при 1 и `-` → удаление (**LOC-04**)

### US-09 — Выбор периода аренды
Как **пользователь** я хочу **выбрать даты и время**, чтобы **посчитать стоимость**.

- Выбор диапазона дат
- Ввод времени начала/окончания
- Повторное открытие показывает предыдущий диапазон → **LOC-02**

### US-10 — Расчёт стоимости
Как **пользователь** я хочу **рассчитать стоимость**, чтобы **увидеть итоговую сумму**.

- Рассчитать можно только при товарах и выбранных датах
- Отображается итоговая сумма

### US-11 — Промокод
Как **пользователь** я хочу **применить промокод**, чтобы **получить скидку**.

- Валидный промокод → цена с/без промокода
- Невалидный промокод → **ERR-04** (не найден)

### US-12 — Экспорт сметы
Как **пользователь** я хочу **экспортировать смету**, чтобы **сохранить/передать её**.

- Экспорт доступен только после расчёта
- Ошибка сервиса → **ERR-01**

### US-13 — Импорт каталога (админ)
Как **администратор** я хочу **импортировать каталог**, чтобы **обновить позиции для всех пользователей**.

- Успех → каталог обновлён, уведомление
- Некорректный файл → **ERR-05**
- Ошибка сервиса → **ERR-01**

### US-14 — Управление пользователями (админ)
Как **администратор** я хочу **создавать/удалять пользователей**, чтобы **управлять доступом**.

- Создание: уникальный email, пароль ≥ 8
- Ошибка валидации → **ERR-02**
- Дубликат → **ERR-03**
- Ошибка сервиса → **ERR-01**

### US-15 — Управление промокодами (админ)
Как **администратор** я хочу **создавать/удалять промокоды**, чтобы **управлять скидками**.

- Создание: уникальный промокод, скидка >0 и <100
- Дубликат → **ERR-03**
- Ошибка валидации → **ERR-02**
- Ошибка сервиса → **ERR-01**

---

## 6. Нефункциональные требования

### 6.1. Безопасность
- Передача данных по защищённому каналу (HTTPS/TLS)
- Пароли не хранятся в открытом виде
- Разграничение доступа по ролям

### 6.2. Надёжность и обработка ошибок
- Ошибки сервиса обрабатываются согласно **ERR-01**
- Система не должна оставаться в частично изменённом состоянии после ошибки

### 6.3. Юзабилити
- Некликабельные кнопки визуально отличаются и не нажимаются
- Валидация формы выполняется до отправки данных

---
