@startuml
title Диаграмма последовательности: Авторизация в системе
actor Пользователь as User
participant "UI (МП)" as UI
participant "Сервис авторизации" as AuthService
participant "База данных" as DB

User -> UI: Открывает экран авторизации
UI -> User: Отображает поля "Логин", "Пароль"\nи некликабельную кнопку "Войти"

User -> UI: Вводит логин и пароль
UI -> UI: Валидирует формат данных\n(проверка email, длина пароля)
alt Валидация не пройдена (ERR-02)
    UI -> User: Подсвечивает поля с ошибками\nи показывает сообщение
    UI -> User: Кнопка "Войти" остаётся некликабельной
else Валидация пройдена
    UI -> User: Кнопка "Войти" становится кликабельной
    User -> UI: Нажимает кнопку "Войти"
    UI -> AuthService: Отправляет запрос на авторизацию\n(логин и хэш пароля)
    
    AuthService -> DB: Запрос на проверку учетных данных
    alt Пользователь не найден (ERR-04)
        DB -> AuthService: Возвращает ошибку "Неверные данные"
        AuthService -> UI: "Неверный логин или пароль"
        UI -> User: Отображает сообщение об ошибке
    else Данные верны
        DB -> AuthService: Возвращает данные пользователя
        AuthService -> AuthService: Создает сессию пользователя
        AuthService -> UI: Успешный ответ + данные сессии
        UI -> UI: Авторизует пользователя в системе
        UI -> UI: Перенаправляет в профиль
        UI -> User: Отображает уведомление об успешном входе
    end
    
    alt Ошибка сервера (ERR-01) на любом этапе
        UI -> User: "Внутренняя ошибка сервиса.\nПожалуйста, попробуйте позже"
        UI -> UI: Сохраняет введённые данные в форме
    end
end

@enduml