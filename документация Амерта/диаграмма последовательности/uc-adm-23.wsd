@startuml
title Диаграмма последовательности: Управление пользователями (Администратор)
actor Администратор as Admin
participant "UI (МП)" as UI
participant "Сервис валидации" as ValidationService
participant "Сервис пользователей" as UserService
participant "База данных" as DB

== Создание пользователя ==

Admin -> UI: Нажимает кнопку создания пользователя
UI -> Admin:  Создает новую строку в таблицу

Admin -> UI: Вводит логин и пароль
UI -> ValidationService: Валидирует формат данных
alt Валидация не пройдена (ERR-02)
    ValidationService -> UI: Возвращает ошибки валидации
    UI -> Admin: Подсвечивает поля с ошибками\nи показывает сообщение
    UI -> Admin: Кнопка "Сохранить" остаётся некликабельной
else Валидация пройдена
    UI -> Admin: Кнопка "Сохранить" становится кликабельной
    Admin -> UI: Нажимает кнопку "Сохранить"
    UI -> UserService: Запрос на создание пользователя\n(данные + проверка уникальности)
    
    UserService -> DB: Проверка существования пользователя с таким email
    alt Пользователь уже существует (ERR-03)
        DB -> UserService: Возвращает информацию о существующем пользователе
        UserService -> UI: "Пользователь с таким логином уже существует"
        UI -> Admin: Отображает сообщение об ошибке
    else Пользователь уникален
        UserService -> UserService: Хэширование пароля
        UserService -> DB: Сохраняет нового пользователя
        DB -> UserService: Подтверждение успешного создания
        UserService -> UI: Успешный ответ
        UI -> Admin: Отображает уведомление об успешном создании пользователя
    end
    
    alt Ошибка сервера (ERR-01) на любом этапе
        UI -> Admin: "Внутренняя ошибка сервиса. Попробуйте позже"
        UI -> UI: Сохраняет введённые данные в форме
    end
end

== Удаление пользователя ==

Admin -> UI: Нажимает кнопку удаления пользователя\n(рядом с конкретным пользователем)
UI -> UserService: Запрос на удаление пользователя

UserService -> DB: Удаляет пользователя и связанные данные
alt Ошибка сервера (ERR-01)
    DB -> UserService: Возвращает ошибку
    UserService -> UI: "Внутренняя ошибка сервиса. Попробуйте позже"
    UI -> Admin: Отображает сообщение об ошибке
else Успешное удаление
    DB -> UserService: Подтверждение удаления
    UserService -> UI: Успешный ответ
    UI -> Admin: Отображает уведомление об успешном удалении пользователя
end

@enduml