@startuml
title Диаграмма последовательности: Просмотр каталога и поиск товаров
actor Пользователь as User
participant "UI (МП)" as UI
participant "Сервис каталога" as CatalogService
participant "Сервис поиска" as SearchService
participant "База данных" as DB
participant "Сервис корзины" as CartService

== Просмотр каталога ==

User -> UI: Открывает главную страницу
UI -> CatalogService: Запрос загрузки каталога
CatalogService -> DB: Получение сгруппированного каталога\n(категории → группы → позиции)
DB -> CatalogService: Возвращает данные каталога
CatalogService -> UI: Передаёт структурированный каталог

UI -> UI: Отображает главную страницу

alt Пользователь кликает на группу
    User -> UI: Нажимает на одну из групп
    UI -> User: Раскрывает группу в виде выпадающего списка\nс наименованием товара, тарифными планами\nи кнопкой добавления в корзину
end

alt Пользователь добавляет товар в корзину (UC-MP-1)
    User -> UI: Нажимает тумблер добавления товара
    UI -> CartService: Запрос на добавление товара в корзину
    CartService -> DB: Сохраняет товар в корзину пользователя
    DB -> CartService: Подтверждение сохранения
    CartService -> UI: Успешный ответ
    
    alt Повторное действие (LOC-03) - удаление товара
        UI -> CartService: Запрос на удаление товара из корзины
        CartService -> DB: Удаляет товар из корзины
        DB -> CartService: Подтверждение удаления
        CartService -> UI: Успешный ответ
    end
end

== Поиск по каталогу (UC-MP-2) ==

User -> UI: Нажимает на поисковую строку\nи начинает вводить символы
UI -> SearchService: Отправляет поисковый запрос

SearchService -> DB: Поиск по названиям групп и позиций
DB -> SearchService: Возвращает результаты поиска

alt Найдены совпадения (ERR-04 - не найдено)
    SearchService -> UI: Передаёт отфильтрованные результаты
    UI -> UI: Отображает только группы и позиции,\nсоответствующие поисковому запросу
else Ничего не найдено
    SearchService -> UI: Пустой результат
    UI -> UI: Отображает пустое состояние\n(нет групп или позиций)
end

alt Пользователь очищает поиск
    User -> UI: Очищает поисковую строку
    UI -> UI: Сбрасывает фильтрацию\nи показывает полный каталог
end

== Обновление каталога (фоновое) ==

group Каталог обновляется администратором (UC-ADM-1)
    Note over CatalogService,DB: Администратор импортирует новый каталог
    CatalogService -> UI: Push-уведомление об обновлении каталога
    UI -> CatalogService: Запрос обновлённых данных
    CatalogService -> DB: Получение нового каталога
    DB -> CatalogService: Новые данные
    CatalogService -> UI: Обновлённый каталог
    UI -> User: Обновляет интерфейс после перезагрузки страницы
end

== Обработка ошибок ==

alt Ошибка сервера (ERR-01) при загрузке каталога
    UI -> User: "Внутренняя ошибка сервиса. Попробуйте позже"
    UI -> UI: Отображает состояние ошибки\nили пустой каталог
end

alt Ошибка сервера (ERR-01) при поиске
    UI -> User: "Внутренняя ошибка сервиса. Попробуйте позже"
    UI -> UI: Сохраняет предыдущие результаты\nили показывает состояние ошибки
end

@enduml